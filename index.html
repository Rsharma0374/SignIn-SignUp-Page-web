<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Manager</title>
    <link rel="stylesheet" href="homePageStyle.css">
    <script src="https://kit.fontawesome.com/1df5c5cc5a.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <div class="form-box">
            <h1 id="title">Sign Up</h1>
            <form>
                <div class="btn-field">
                    <button type="button" id="signupBtn">Sign Up</button>
                    <button type="button" id="signinBtn" class="disable">Sign In</button>
                </div>
                <div class="input-group">

                    <div class="input-field" id="nameField">
                        <i class="fa-solid fa-envelope"></i>
                        <input type="email" id="emailIdField" placeholder="Email" oninput="validateEmail()">
                    </div>

                    <div class="input-field" id="genderField">
                        <i class="fa-solid fa-venus-mars"></i>
                        <select id="genderSelect" placeholder="Gender">
                            <option value="" selected disabled hidden>Choose Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>

                    <div class="input-field" id="mobileNumberField">
                        <i class="fa-solid fa-phone"></i>
                        <input type="number" id="mobileNumberInput" placeholder="Mobile Number" pattern="[0-9]{10}"
                            oninput="validateMobileNumber()">
                    </div>

                    <div class="input-field">
                        <i class="fa-solid fa-user"></i>
                        <input type="text" id="usernameField" placeholder="Username" oninput="validateUsername()">
                    </div>

                    <div class="input-field">
                        <i class="fa-solid fa-lock"></i>
                        <input type="password" id="passwordField" placeholder="Password">
                    </div>
                    <p> Forgot Password? <a href="#">Click Here</a> </p>
                </div>
                <div class="btn-field-2">
                    <button type="button" id="createBtn">Sign Up</button>
                    <button type="button" id="loginBtn" class="disabled">Login</button>
                </div>
            </form>
        </div>

        <!-- Loading icon -->
        <div class="loading-icon">Loading...</div>

        <!-- Success popup -->
        <div id="success-popup">
            <p id="success-message"></p>
            <button onclick="closePopup()">OK</button>
        </div>
    </div>
</body>
<script>

    let signupBtn = document.getElementById("signupBtn");
    let signinBtn = document.getElementById("signinBtn");
    let nameField = document.getElementById("nameField");
    let genderField = document.getElementById("genderField");
    let mobileNumberField = document.getElementById("mobileNumberField");
    let title = document.getElementById("title");
    var createButton = document.getElementById("createBtn");
    var loginButton = document.getElementById("loginBtn");
    var loadingIcon = document.querySelector('.loading-icon');
    var successPopup = document.getElementById('success-popup');
    var successMessage = document.getElementById('success-message');

    createButton.style.display = "block";
    loginButton.style.display = "none";

    signinBtn.onclick = function () {
        nameField.style.maxHeight = "0";
        genderField.style.maxHeight = "0";
        mobileNumberField.style.maxHeight = "0";
        title.innerHTML = "Sign In";
        signupBtn.classList.add("disable");
        signinBtn.classList.remove("disable");
        createButton.style.display = "none";
        loginButton.style.display = "block";
    }

    signupBtn.onclick = function () {
        nameField.style.maxHeight = "60px";
        genderField.style.maxHeight = "60px"
        mobileNumberField.style.maxHeight = "60px";
        title.innerHTML = "Sign Up";
        signupBtn.classList.remove("disable");
        signinBtn.classList.add("disable");
        createButton.style.display = "block";
        loginButton.style.display = "none";
    }

    function validateUsername() {
        let usernameInput = document.getElementById("usernameField");
        let usernameValue = usernameInput.value;

        let sanitizedValue = usernameValue.replace(/[^a-zA-Z0-9]/g, '');

        usernameInput.value = sanitizedValue;
    }

    function validateEmail() {
        let usernameInput = document.getElementById("emailIdField");
        let usernameValue = usernameInput.value;

        let sanitizedValue = usernameValue.replace(/[ ]/g, '');

        usernameInput.value = sanitizedValue;
    }

    function closePopup() {
        successPopup.style.display = 'none';
    }

    function validateMobileNumber() {
        let mobileNumberInput = document.getElementById("mobileNumberInput");
        let mobileNumberValue = mobileNumberInput.value;

        let sanitizedValue = mobileNumberValue.replace(/[^0-9]/g, '');

        sanitizedValue = sanitizedValue.slice(0, 10);

        mobileNumberInput.value = sanitizedValue;


    }

    // API to create new user start
    document.getElementById("createBtn").addEventListener("click", function () {
        // Get form data
        var formData = {
            "sUserName": document.getElementById("usernameField").value,
            "sEmailId": document.getElementById("emailIdField").value,
            "sPassword": document.getElementById("passwordField").value,
            "sGender": document.getElementById("genderSelect").value,
            "sPhoneNumber": document.getElementById("mobileNumberInput").value,
            "bAccountActive": true
        };

        if (formData.sPhoneNumber.length < 10) {
            alert("Mobile number should be 10 digits");
            return;
        }
        if (formData.sUserName === '') {
            alert("Username cannot be blank")
            return;
        }
        if (formData.sEmailId === '') {
            alert("Email cannot be blank")
            return;
        }
        if (formData.sPassword === '') {
            alert("Password cannot be blank")
            return;
        }
        if (formData.sGender === '') {
            alert("Gender cannot be blank")
            return;
        }
        
        console.log(formData)

        fetch("https://user-auth-iduw.onrender.com/user/new-user", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(formData)
        })
            .then(response => response.json())
            .then(data => {

                loadingIcon.style.display = 'none';

                successMessage.textContent = data.oBody.payLoad;
                successPopup.style.display = 'block';

                // Clear form inputs
                document.getElementById('usernameField').value = '';
                document.getElementById('emailIdField').value = '';
                document.getElementById('passwordField').value = '';
                document.getElementById("genderSelect").value = '';
                document.getElementById("mobileNumberInput").value = '';
                console.log("API Response:", data);
            })
            .catch(error => {
                alert(error)
                console.error("Error:", error);
            });
            
    });

//API to ctreate new User Ends


</script>

</html>